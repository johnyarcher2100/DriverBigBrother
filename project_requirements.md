# 專案需求文檔 - 運將大哥叫車服務應用程式

## 1. 專案概述

本專案旨在構建一個名為「運將大哥」的叫車應用程式框架。系統設計用於支持需要可靠叫車服務且具有直觀移動介面的隨機用戶。主要目標是通過使用Supabase提供的強大後端（包括PostgreSQL和PostGIS用於處理地理位置數據）以及使用React Native構建的移動應用程式，實時連接乘客和司機。核心功能包括實時訂閱更新、使用Google Maps進行高效路線規劃、為台灣市場量身定制的安全支付，以及提升的安全措施，如駕照驗證、人臉識別和驗證碼。

該應用程式的構建旨在解決傳統叫車服務的常見痛點。它通過基於實時交通數據提供準確的ETA預測、使用實時更新實現司機和乘客之間的清晰溝通，以及提供強大的安全功能保護用戶和司機的敏感信息，從而改善用戶體驗。此專案的關鍵目標是確保可靠性、響應性和安全性，同時提供支付系統和地理位置服務的順暢整合。

## 2. 範圍內與範圍外

**範圍內：**

* 用戶註冊和使用手機號碼驗證（基於驗證碼）的登錄
* 乘客預訂流程，包括使用Google Maps API輸入目的地和路線規劃
* 使用Supabase訂閱的實時司機匹配、位置更新和行程狀態通知
* 司機管理，包括狀態更新（空閒、忙碌）和位置追蹤
* 用戶管理、司機管理、行程請求和訊息傳遞的全面API端點
* 安全支付整合，支持Line Pay、StreetPay和信用卡（專為台灣市場設計）
* 增強的安全措施，包括敏感數據加密、通信TLS/SSL，以及額外的身份驗證（駕照、人臉識別）
* 路線規劃增強功能，如基於交通數據的替代路線和重新計算的ETA
* 基本拼車功能，如與信任聯繫人共享行程和緊急聯繫按鈕

**範圍外：**

* 除Google Maps API外，支持多個外部地圖或交通數據提供商
* 詳細的品牌風格、設計指南或自定義視覺主題（使用Tailwind CSS和Shadcn UI的默認樣式）
* 此版本的微服務架構實施（未來迭代可探索完整微服務）
* 除Supabase訂閱外，與其他第三方實時通知系統（如Firebase）的整合
* 用於大規模部署的廣泛可擴展性功能（初期專注於具有容器友好部署的單體架構）

## 3. 用戶流程

當用戶首次打開應用程式時，他們會看到一個簡單明了的屏幕，提示他們註冊或登錄。新用戶使用必要的詳細信息和基於驗證碼的手機號碼驗證過程完成註冊。註冊後，用戶可以登錄並被重定向到主儀表板，提供清晰的導航選項，包括他們當前的位置、目的地輸入和訪問任何先前的行程歷史。

登錄後，乘客輸入目的地，觸發應用程式使用Google Maps API進行路線規劃和實時交通分析。系統然後使用地理位置數據將乘客與附近的司機匹配。司機收到關於行程請求的實時通知，並在應用程式中更新其狀態和位置。在整個行程中，用戶可以追蹤司機的進度，查看動態ETA更新，並與信任的聯絡人共享行程詳情，確保通過連續更新維持行程狀態和安全。

## 4. 核心功能

* **身份驗證和用戶管理：**
    * 通過手機號碼和驗證碼的用戶註冊和登錄
    * 端點支持：POST /api/v1/auth/register, POST /api/v1/auth/login, GET /api/v1/users/me, PATCH /api/v1/users/me

* **司機管理：**
    * 實時司機位置更新和狀態管理（空閒/忙碌）
    * 端點支持：POST /api/v1/drivers/location, PATCH /api/v1/drivers/status, GET /api/v1/drivers/stats

* **行程請求和匹配：**
    * 基於當前地理位置和目的地輸入的乘客行程請求
    * 使用實時訂閱找到附近司機的匹配服務
    * 端點支持：POST /api/v1/rides, GET /api/v1/rides/active, GET /api/v1/rides/:id, PATCH /api/v1/rides/:id/status, GET /api/v1/rides/history

* **實時通信：**
    * 基於訂閱的司機位置和行程狀態更新通知
    * 乘客和司機之間的通信訊息系統
    * 端點支持：POST /api/v1/messages, GET /api/v1/messages/:rideId, PATCH /api/v1/messages/:id/read

* **地理位置和路線規劃：**
    * 與Google Maps API集成，用於路線生成和實時交通洞察
    * 基於實時司機定位和交通分析的動態ETA重新計算

* **支付整合：**
    * 支持多種支付方式，包括Line Pay、StreetPay和信用卡
    * 基於距離、時間和需求的自動計費計算
    * 強大的支付安全性和合規性（針對台灣市場）

* **安全增強：**
    * 敏感信息的數據加密和安全通信的TLS/SSL
    * 身份驗證方法（駕照驗證、人臉識別）
    * 行程共享和緊急聯繫功能

## 5. 技術棧和工具

* **前端：**
    * 移動應用：React Native（選擇用於跨平台支持）
    * 啟動套件：使用Vite、Tailwind CSS、Typescript和Shadcn UI的React + Supabase，用於快速UI開發

* **後端：**
    * Supabase提供後端即服務，具有PostgreSQL和PostGIS用於地理位置支持
    * RESTful API設計，用於清晰的端點和一致的數據管理

* **地圖和地理位置：**
    * Google Maps API用於路線規劃、實時交通監控和ETA計算

* **實時通信：**
    * Supabase訂閱處理實時更新（司機位置、行程狀態變更和通知）

* **支付整合：**
    * 與本地支付系統整合（Line Pay、StreetPay、信用卡）
    * 後端邏輯中內置的自動計費算法

* **其他工具：**
    * ChatGPT（GPT-4 O1模型）用於高級代碼生成
    * VS Code用於代碼編輯和調試
    * Replit用於在線IDE和協作編碼
    * Deepseek和Claude AI用於額外的代碼協助和模型支持

## 6. 非功能性需求

* **性能：**
    * 系統應提供實時更新，延遲最小（目標是近乎即時的訂閱）
    * 行程匹配和ETA重新計算應快速處理以保持流暢的體驗

* **安全：**
    * 所有敏感數據必須在傳輸中（使用TLS/SSL）和靜止時加密
    * 支付流程必須符合地區安全標準，幫助確保符合當地金融法規（例如，信用卡處理的PCI-DSS）

* **可用性和無障礙性：**
    * 用戶界面應保持簡單、清晰且易於導航
    * 確保司機和乘客都能輕鬆訪問所有應用功能，最小化混淆

* **可靠性：**
    * 實時訂閱和API端點必須優雅地處理突然的網絡中斷或弱網絡條件
    * 系統應足夠強健，能夠管理台灣市場中的預期負載

## 7. 限制和假設

* 後端高度依賴Supabase和PostgreSQL與PostGIS，因此其可用性和性能是關鍵依賴項。
* 初始版本將專注於單體架構，即使未來可擴展性可能考慮微服務方法。
* 所選擇的第三方API，如Google Maps，假設對於預期用途而言是穩定且無區域限制的。
* 開發以React Native為中心進行移動應用，此階段不考慮使用Flutter進行進一步的跨平台增強。
* 假設目標市場是台灣，這意味著支付網關和貨幣支持將相應定制。

## 8. 已知問題和潛在隱患

* **實時更新：**
    * 僅依賴Supabase訂閱可能導致流量突然增加時的性能問題。可能需要監控API速率限制並考慮備選方案。

* **API速率限制和對第三方服務的依賴：**
    * 使用Google Maps API進行路線規劃和交通數據可能受到速率限制。優化API調用，並考慮在可能的情況下緩存頻繁請求。

* **安全風險：**
    * 處理敏感個人和支付數據需要嚴格實施加密和安全通信協議。確保進行徹底的代碼審查和合規性測試，以避免潛在的數據洩露。

* **可擴展性挑戰：**
    * 雖然當前設計是單體的，但隨著負載增加，擴展可能成為問題。通過設計具有關注點分離的端點和模塊來緩解這一問題，以便以後更順暢地轉向微服務架構。

* **網絡可靠性：**
    * 移動網絡可能不可預測。為弱或不穩定的連接構建強大的錯誤處理，特別是針對實時司機更新和基於訂閱的通知。

本文檔作為AI模型理解和生成所有後續技術文檔的綜合指南。它以直接、日常語言解釋了目的、用戶交互、核心功能、技術選擇和潛在技術挑戰。
